<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Galaxia para ti</title>
  <meta name="description" content="Galaxia interactiva de frases de cari√±o üíò">
  <meta property="og:title" content="Galaxia para Alondrita">
  <meta property="og:description" content="Una galaxia hecha con amor para Alondra üíñ">
  <meta property="og:image" content="og-cover.png">
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    html,body{margin:0;height:100%;background:#000;overflow:hidden}
    #startBtn {
      display: block;
      transition: transform 0.18s cubic-bezier(.4,2,.6,1), box-shadow 0.18s;
      animation: pulseBtn 1.2s infinite cubic-bezier(.4,0,.6,1);
    }
    #startBtn:hover, #startBtn:focus {
      transform: scale(1.09);
      box-shadow: 0 0 32px 8px #e7baff99, 0 0 0 2px #fff2;
      outline: none;
    }
    @keyframes pulseBtn {
      0% { transform: scale(1); box-shadow: 0 0 0 0 #e7baff44; }
      60% { transform: scale(1.13); box-shadow: 0 0 32px 8px #e7baff99; }
      100% { transform: scale(1); box-shadow: 0 0 0 0 #e7baff44; }
    }
    #galaxy-canvas{position:fixed;inset:0;width:100%;height:100%;display:block;touch-action:none}
    .attribution{position:fixed;left:10px;bottom:10px;font-size:11px;color:#b9a0ff;opacity:.8;background:rgba(0,0,0,.35);padding:6px 8px;border-radius:8px}
    .player{position:fixed;left:10px;right:10px;bottom:10px;display:flex;gap:8px;align-items:center;
             background:rgba(20,15,35,.35);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:8px;
             backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);color:#fff;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial}
    .player button{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff}
    .player input[type=file]{display:none}
    .pill{position:fixed;top:10px;left:50%;transform:translateX(-50%);padding:6px 12px;border-radius:999px;
          background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);color:#fff;font:12px -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial}
    .error{position:fixed;inset:auto 10px 70px 10px;background:#260015;color:#ffd9f7;border:1px solid #ff8ae5;border-radius:10px;padding:10px;font:12px system-ui;display:none;}
  </style>
  <!-- Three.js legacy non-module build + OrbitControls (r128, super estable) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>

<!-- Modal de inicio -->
<div id="startModal" style="position:fixed;inset:0;z-index:1000;background:#000;display:flex;align-items:center;justify-content:center;flex-direction:column;">
  <button id="startBtn" style="background:none;border:none;outline:none;cursor:pointer;padding:0;">
  <img src="https://raw.githubusercontent.com/rkive47/alondra/refs/heads/main/iloveimg-converted/a1a58f8a-7752-4184-bdec-785747a212bc.png" alt="Iniciar" style="width:270px;height:270px;display:block;">
  </button>
</div>

<audio id="bgMusic" src="https://github.com/Baque2005/ReparacionSysteclinx/raw/refs/heads/main/Eldar%20Kedem%20-%20%20Walking%20Around.mp3" preload="auto"></audio>

<canvas id="galaxy-canvas"></canvas>


<div id="err" class="error"></div>

<canvas id="fx" style="position:fixed;inset:0;pointer-events:none;"></canvas>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const modal = document.getElementById('startModal');
  const btn = document.getElementById('startBtn');
  const music = document.getElementById('bgMusic');

  btn.addEventListener('click', function() {
    modal.style.display = 'none';
    // Reproducir m√∫sica (manejo de autoplay)
    music.volume = 0.7;
    music.currentTime = 0;
    const playPromise = music.play();
    if (playPromise !== undefined) {
      playPromise.catch(()=>{});
    }
    // Iniciar galaxia con animaci√≥n cinematogr√°fica
    runGalaxy({ cinematic: true });
  });

  function runGalaxy(opts={}){
    const err = document.getElementById('err');
    function showError(msg){ err.textContent = msg; err.style.display='block'; }

    // ====== WEBGL CHECK ======
    try { 
      const test = document.createElement('canvas').getContext('webgl') || document.createElement('canvas').getContext('experimental-webgl');
      if(!test) throw new Error('Tu navegador no tiene WebGL activo');
    } catch(e) { showError('WebGL parece desactivado. Prueba con Chrome/Edge/Firefox, o habilita aceleraci√≥n por hardware.'); return; }

    // ====== THREE.JS GALAXY ======
    try {
      // ...existing code...
      // (todo el c√≥digo de la galaxia va aqu√≠, igual que antes)
      // ...existing code...
      // (copiado del bloque try original)

      // Setup
      const canvas = document.getElementById('galaxy-canvas');
      const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:false });
      renderer.setPixelRatio(Math.min(2, window.devicePixelRatio||1));
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.outputEncoding = THREE.sRGBEncoding;

      const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true; controls.dampingFactor = 0.06;
  controls.minDistance = 10; controls.maxDistance = 220;
  controls.target.set(0,0,0);

  // Cinematic animation state
  let cinematicState = opts.cinematic ? 0 : null;
  let cinematicStart = null;
  let cinematicDuration1 = 2.2; // segundos: zoom in
  let cinematicDuration2 = 3.5; // segundos: giro
  let cinematicDuration3 = 2.2; // segundos: zoom final alej√°ndose
  let cinematicTotal = cinematicDuration1 + cinematicDuration2 + cinematicDuration3;

      function setCam(){
        const w = window.innerWidth, h = window.innerHeight;
        const isMobile = w < 768 || w < h;
        camera.fov = isMobile ? 90 : 75;
        camera.position.set(0, isMobile? 26 : 22, isMobile? 110 : 75);
        camera.updateProjectionMatrix(); controls.update();
      }
      setCam();

      renderer.setClearColor(0x000000, 1);

      const explosions = [];
      function spawnExplosion() {
        const geo = new THREE.PlaneGeometry(60, 60);
        const c = document.createElement('canvas');
        c.width = c.height = 256;
        const g = c.getContext('2d');
        const grad = g.createRadialGradient(128,128,10,128,128,128);
        grad.addColorStop(0, 'rgba(255,255,200,0.85)');
        grad.addColorStop(0.2, 'rgba(255,220,120,0.45)');
        grad.addColorStop(0.5, 'rgba(255,180,255,0.18)');
        grad.addColorStop(1, 'rgba(0,0,0,0)');
        g.fillStyle = grad;
        g.fillRect(0,0,256,256);
        const tex = new THREE.CanvasTexture(c);
        const mat = new THREE.MeshBasicMaterial({ map: tex, transparent: true, depthWrite: false, blending: THREE.AdditiveBlending });
        const mesh = new THREE.Mesh(geo, mat);
        const angle = Math.random() * Math.PI * 2;
        const dist = 70 + Math.random() * 60;
        mesh.position.set(Math.cos(angle)*dist, (Math.random()-0.5)*40, Math.sin(angle)*dist);
        mesh.lookAt(0,0,0);
        mesh.material.opacity = 0.85;
        mesh.userData.life = 1.0;
        explosions.push(mesh);
        scene.add(mesh);
      }

      setInterval(()=>{
        if(Math.random()<0.85) spawnExplosion();
      }, 700);

      const galaxy = new THREE.Group(); scene.add(galaxy);
      const phrases = [
        "Mi Reynaüëë", "Enano", "Mi Solecito ‚òÄÔ∏è", "Mi Vida", "Mi Cielito üåå", "Mi Tesoro üíé", "Mi Campe√≥na üèÜ", "Mi Todo", "Mi pulguita", "Mi Universo", "Mi Princesa", "Mi Luz üå†", "Mi Ni√±a", "Mi Paz", "Mi chiquita", "Mi Sue√±o", "Mi Pensamiento Favorito", "Mi Bomb√≥n", "Mi Razon de brillar", "Te Admiro", "Te Quiero Mucho", "Eres √önica", "Eres Especial", "Eres Incre√≠ble", "Te Amo Infinitamente ‚ôæÔ∏è"
      ];
      const phraseCount = Math.max(phrases.length * 8, 240);
      const arms = 5, radius = 82, maxH = 22;
     const ringImgs = [
  "https://raw.githubusercontent.com/rkive47/alondra/main/iloveimg-converted/1c4fb88ad215df205a03ca8c7b6bddc1.png",
  "https://raw.githubusercontent.com/rkive47/alondra/main/iloveimg-converted/04b65bb06a3504e4e82d40d77ef7e99e-copy-0.png",
  "https://raw.githubusercontent.com/rkive47/alondra/main/iloveimg-converted/31813e134394485a11144a88248c963c.png",
  "https://raw.githubusercontent.com/rkive47/alondra/main/iloveimg-converted/613acd2e6b7667d6ba6c692f36cfc742.png",
  "https://raw.githubusercontent.com/rkive47/alondra/main/iloveimg-converted/bd7d77542184569d301a1c23cf1f58a8.png",
  "https://raw.githubusercontent.com/rkive47/alondra/main/iloveimg-converted/d6f163b8cd58cb2688fad111a1d60cab.png"
];

      function makeTextTexture(text, size=48){
        const c=document.createElement('canvas'); c.width=1024; c.height=128;
        const g=c.getContext('2d'); g.clearRect(0,0,c.width,c.height);
        g.font='800 '+size+'px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial';
        g.textAlign='center'; g.textBaseline='middle';
        g.shadowColor='rgba(210,140,255,0.95)'; g.shadowBlur=24;
        g.fillStyle='rgba(255,240,255,0.98)'; g.fillText(text,c.width/2,c.height/2);
        return new THREE.CanvasTexture(c);
      }
      function makeImageTexture(url, cb) {
        const img = new window.Image();
        img.crossOrigin = "anonymous";
        img.onload = function() {
          const c = document.createElement('canvas');
          c.width = 256; c.height = 256;
          const g = c.getContext('2d');
          g.clearRect(0,0,256,256);
          g.filter = 'contrast(1.25) saturate(1.25)';
          g.drawImage(img, 0, 0, 256, 256);
          g.filter = 'none';
          cb(new THREE.CanvasTexture(c));
        };
        img.src = url;
      }
      const totalSprites = phraseCount;
      const imgCount = Math.floor(totalSprites * 0.35);
      let imgPointer = 0;
      for(let i=0;i<totalSprites;i++){
        const perArm=totalSprites/arms; const ang=(i%perArm)*(Math.PI*2/perArm);
        const armAng=Math.floor(i/perArm)*(Math.PI*2/arms);
        const minDist = radius * 1.18, maxDist = radius * 1.38;
        const dist = minDist + (maxDist - minDist) * (i/totalSprites);
        const thickness=Math.pow(1-(dist/(radius*1.38)),2);
        const x=Math.cos(ang+armAng)*dist, z=Math.sin(ang+armAng)*dist, y=(Math.random()-0.5)*maxH*thickness*.9;
        const isTop = y > (maxH*0.7);
        const isBottom = y < -(maxH*0.7);
        if ((i < imgCount || isTop || isBottom) && ringImgs.length > 0) {
          const imgUrl = ringImgs[imgPointer % ringImgs.length];
          makeImageTexture(imgUrl, function(tex){
            const spr = new THREE.Sprite(new THREE.SpriteMaterial({ map: tex, color: 0xffffff, transparent: true, depthWrite: false }));
            spr.position.set(x, y + 10, z);
            spr.scale.set(8, 8, 1);
            galaxy.add(spr);
          });
          imgPointer++;
        } else {
          const text = phrases[i%phrases.length];
          const tex=makeTextTexture(text,48);
          const spr=new THREE.Sprite(new THREE.SpriteMaterial({ map:tex, transparent:true, depthWrite:false }));
          spr.isPhrase=true;
          spr.position.set(x,y,z); spr.scale.set(20,2.6,1); galaxy.add(spr);
        }
      }
      const starCount=8000, geom=new THREE.BufferGeometry(), pos=new Float32Array(starCount*3);
      for(let i=0;i<starCount;i++){ const ang=Math.random()*Math.PI*2, dist=Math.random()*radius*1.15;
        const y=(Math.random()-0.5)*36*Math.pow(1-Math.min(dist,radius)/radius,1.5);
        pos[i*3]=Math.cos(ang)*dist; pos[i*3+1]=y; pos[i*3+2]=Math.sin(ang)*dist; }
      geom.setAttribute('position', new THREE.BufferAttribute(pos,3));
      galaxy.add(new THREE.Points(geom, new THREE.PointsMaterial({ color:0xffffff, size:0.28, transparent:true, opacity:0.65, blending:THREE.AdditiveBlending })));
      const coreR = 12;
      const coreTexCanvas = document.createElement('canvas');
      coreTexCanvas.width = coreTexCanvas.height = 256;
      const cg = coreTexCanvas.getContext('2d');
      const grd = cg.createRadialGradient(128,128,10,128,128,128);
      grd.addColorStop(0, '#3a7cff');
      grd.addColorStop(0.5, '#0a2a6b');
      grd.addColorStop(1, '#000a2a');
      cg.fillStyle = grd;
      cg.arc(128,128,128,0,Math.PI*2);
      cg.fill();
      const core = new THREE.Mesh(
        new THREE.SphereGeometry(coreR, 64, 64),
        new THREE.MeshPhongMaterial({ map: new THREE.CanvasTexture(coreTexCanvas), shininess: 60, specular: 0x7ecbff })
      );
      core.renderOrder = 1;
      scene.add(core);
      const light = new THREE.PointLight(0x7ecbff, 1.2, 200);
      light.position.set(0, 30, 60);
      scene.add(light);
      let imgMesh = null;
      const loader = new THREE.TextureLoader();
      loader.load('Feliz cumplea√±os', function(tex) {
        const imgSize = coreR * 1.7;
        imgMesh = new THREE.Mesh(
          new THREE.PlaneGeometry(imgSize, imgSize),
          new THREE.MeshBasicMaterial({ map: tex, transparent: true })
        );
        imgMesh.position.set(0, coreR * 2.1, 0);
        imgMesh.renderOrder = 2;
        scene.add(imgMesh);
      });
      const photonRing=new THREE.Mesh(new THREE.RingGeometry(coreR*1.05, coreR*1.18, 128), new THREE.MeshBasicMaterial({ color:0xEAAEFF, transparent:true, opacity:0.95, side:THREE.DoubleSide }));
      photonRing.rotation.x=-Math.PI/2; photonRing.renderOrder=0.5; scene.add(photonRing);
      function makeHaloTexture(size=1024, inner=0.45){
        const c=document.createElement('canvas'); c.width=c.height=size; const g=c.getContext('2d'); const r=size/2;
        const grd=g.createRadialGradient(r,r,r*inner, r,r,r);
        grd.addColorStop(0.0,'rgba(255,200,240,0.45)');
        grd.addColorStop(0.35,'rgba(220,180,255,0.35)');
        grd.addColorStop(0.7,'rgba(160,200,255,0.28)');
        grd.addColorStop(1,'rgba(0,0,0,0)');
        g.fillStyle=grd; g.fillRect(0,0,size,size); const tex=new THREE.CanvasTexture(c); tex.needsUpdate=true; return tex;
      }
      const haloPlane=new THREE.Mesh(new THREE.PlaneGeometry(320,320), new THREE.MeshBasicMaterial({ map:makeHaloTexture(1024,0.45), transparent:true, depthWrite:false, blending:THREE.AdditiveBlending, opacity:0.9 }));
      haloPlane.rotation.x=-Math.PI/2; haloPlane.renderOrder=0.2; scene.add(haloPlane);
      function animate(){
        requestAnimationFrame(animate);
        const t = performance.now()*0.001;
        // Cinematic animation
        if (cinematicState !== null) {
          if (cinematicStart === null) cinematicStart = t;
          const elapsed = t - cinematicStart;
          if (elapsed < cinematicDuration1) {
            // Zoom in desde lejos al centro (no tan cerca)
            const prog = elapsed / cinematicDuration1;
            camera.position.lerpVectors(
              new THREE.Vector3(0, 0, 220), // inicio lejos
              new THREE.Vector3(0, 18, 38),  // m√°s lejos y arriba
              prog
            );
            camera.lookAt(0,0,0);
            controls.enabled = false;
          } else if (elapsed < cinematicDuration1 + cinematicDuration2) {
            // Giro alrededor
            const prog = (elapsed-cinematicDuration1) / cinematicDuration2;
            const angle = Math.PI/2 + prog * Math.PI * 2 * 0.85;
            const radius = 38;
            const y = 18;
            camera.position.x = Math.cos(angle) * radius;
            camera.position.y = y;
            camera.position.z = Math.sin(angle) * radius;
            camera.lookAt(0,0,0);
            controls.enabled = false;
          } else if (elapsed < cinematicTotal) {
            // Zoom final alej√°ndose al m√°ximo y subiendo la c√°mara
            const prog = (elapsed - cinematicDuration1 - cinematicDuration2) / cinematicDuration3;
            const startAngle = Math.PI/2 + Math.PI * 2 * 0.85;
            const startRadius = 38;
            const endRadius = 220; // lo m√°s lejos posible
            const startY = 18;
            const endY = 80; // vista elevada
            camera.position.x = Math.cos(startAngle) * (startRadius + (endRadius-startRadius)*prog);
            camera.position.y = startY + (endY-startY)*prog;
            camera.position.z = Math.sin(startAngle) * (startRadius + (endRadius-startRadius)*prog);
            camera.lookAt(0,0,0);
            controls.enabled = false;
          } else {
            // Fin de la animaci√≥n, dejar la c√°mara en la posici√≥n final elevada y activar controles
            controls.enabled = true;
            cinematicState = null;
            // No llamar a setCam, mantener la posici√≥n final
          }
        }
        galaxy.rotation.y = t * 0.05;
        core.rotation.y = t * 0.12;
        photonRing.rotation.z = t * 0.18;
        haloPlane.rotation.z = t * 0.02;
        if(imgMesh && camera){
          imgMesh.lookAt(camera.position);
        }
        for(let i=explosions.length-1;i>=0;i--){
          const e = explosions[i];
          e.material.opacity *= 0.94;
          e.userData.life -= 0.018;
          if(e.userData.life<=0.05){
            scene.remove(e);
            explosions.splice(i,1);
          }
        }
        controls.update();
        renderer.render(scene, camera);
      }
      animate();
      // ====== HEARTS OVERLAY (double tap/click) ======
      const fx = document.getElementById('fx');
      const ctx2 = fx.getContext('2d');
      function resizeFx(){
        fx.width = Math.floor(innerWidth * Math.min(2, window.devicePixelRatio||1));
        fx.height = Math.floor(innerHeight * Math.min(2, window.devicePixelRatio||1));
        fx.style.width = innerWidth + 'px';
        fx.style.height = innerHeight + 'px';
      }
      addEventListener('resize', resizeFx); resizeFx();
      const DPR = Math.min(2, window.devicePixelRatio || 1);
      const hearts = [];
      function spawnHearts(x,y,n=20){
        x *= DPR; y *= DPR;
        for(let i=0;i<n;i++){ const a=Math.random()*Math.PI*2;
          hearts.push({x,y,vx:Math.cos(a)*(0.6+Math.random()*0.8),vy:-(0.8+Math.random()*1.2),life:1,size:10+Math.random()*16});
        }
      }
      function drawHeart(x,y,size){
        const s=size; ctx2.save(); ctx2.translate(x,y);
        ctx2.beginPath(); ctx2.moveTo(0,-0.25*s);
        ctx2.bezierCurveTo(.5*s,-.9*s,1.4*s,-.1*s,0,.9*s);
        ctx2.bezierCurveTo(-1.4*s,-.1*s,-.5*s,-.9*s,0,-.25*s);
        const g=ctx2.createRadialGradient(0,0,0,0,0,s);
        g.addColorStop(0,'rgba(255,190,220,.95)'); g.addColorStop(1,'rgba(255,90,160,0)');
        ctx2.fillStyle=g; ctx2.fill(); ctx2.restore();
      }
      let lastTap=0;
      addEventListener('click', (e)=>{ const now=performance.now(); if(now-lastTap<320) spawnHearts(e.clientX,e.clientY,20); lastTap=now; }, {passive:true});
      addEventListener('touchend', (e)=>{ const now=performance.now(); const t=e.changedTouches&&e.changedTouches[0]; if(now-lastTap<320&&t) spawnHearts(t.clientX,t.clientY,20); lastTap=now; }, {passive:true});
      function loopFx(){
        ctx2.clearRect(0,0,fx.width,fx.height);
        for(let i=hearts.length-1;i>=0;i--){ const h=hearts[i]; h.x+=h.vx; h.y+=h.vy; h.vy-=0.02; h.life-=0.015;
          ctx2.globalAlpha=Math.max(0,h.life); drawHeart(h.x,h.y,h.size); ctx2.globalAlpha=1; if(h.life<=0) hearts.splice(i,1);
        }
        requestAnimationFrame(loopFx);
      } loopFx();
    } catch(e) { showError('Error cargando la galaxia: '+e.message); console.error(e); }
  }
});
</script>
</body>
</html>
